# Caddyfile для AI Drone Creator
# Основной домен
ai-drone-creator-website.up.railway.app {
    # Отдаём статические файлы из текущей директории
    root * /app
    file_server {
        hide .git
        hide .env
        hide Caddyfile
    }
    
    # Настройка кэширования для статических файлов
    header {
        Cache-Control "public, max-age=3600"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Referrer-Policy "strict-origin-when-cross-origin"
    }
    
    # Обработка 404 - для SPA (Single Page Application)
    @notFound {
        file {
            try_files {path} {path}/ /index.html
        }
    }
    handle @notFound {
        rewrite * /index.html
        file_server /index.html
    }
    
    # Сжатие
    encode gzip
    
    # Логирование
    log {
        output stdout
        format console
    }
}

# Бэкенд API
ai-drone-creator-backend-1-production.up.railway.app {
    # Прокси к бэкенду на порту 8080
    reverse_proxy localhost:8080 {
        header_up Host {host}
        header_up X-Real-IP {remote}
        header_up X-Forwarded-For {remote}
        header_up X-Forwarded-Proto {scheme}
    }
    
    # Логирование
    log {
        output stdout
        format console
    }
}

# Health check endpoint
:8080 {
    handle /health {
        respond "{\"status\":\"healthy\",\"timestamp\":\"2006-01-02T15:04:05Z07:00\",\"service\":\"ai-drone-creator\"}" 200 {
            Content-Type "application/json"
        }
    }
    
    # Если запрос не /health, возвращаем 404
    handle {
        respond "Not Found" 404
    }
}
